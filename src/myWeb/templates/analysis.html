<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>5U-分析系统</title>
    <link rel="shortcut icon" href="/static/images/icoo.ico" />
    <link rel="stylesheet" href=" /static/css/initial.css ">
    <link rel="stylesheet" href=" /static/css/analystyle.css ">
    <link rel="stylesheet" href=" /static/css/common.css ">
    <script src="/static/js/echarts.min.js"></script>
    <script src="/static/js/provinces.js"></script>
    <script src="/static/js/china.js"></script>
    <script type="text/javascript" src="/static/js/jquery-3.3.1.min.js" ></script>
</head>
<body>
<div class="banner">
    <img src="/static/images/analy1.png" alt="" align="center" width="100%" height="100%">
</div>
<div class="box clearfix">
    <!--subnav-->
    <div class="menu clearfix">
        <ul>
		<li>
			<span>企业分析<i class="icon"></i></span>
			<dl>
				<dt><a href="javascript:void(0);" onclick="getData('companySize')">企业规模</a></dt>
				<dt><a href="javascript:void(0);" onclick="getData('companyType')">企业性质</a></dt>
			</dl>
		</li>
		<li>
			<span><a href="javascript:void(0);" onclick="getData('region_number')">地区分析</a></span>
		</li>
		<li>
			<span>学历/经验分析<i class="icon"></i></span>
			<dl>
				<dt><a href="javascript:void(0);" onclick="getData('education_number')">学历分析</a></dt>
				<dt><a href="javascript:void(0);" onclick="getData('experience_number')">经验分析</a></dt>
			</dl>
		</li>
		<li>
			<span>薪资水平分析<i class="icon"></i></span>
			<dl>
				<dt><a href="javascript:void(0);" onclick="getData('education_salary')">薪资与学历关系</a></dt>
                <dt><a href="javascript:void(0);" onclick="getData('experience_salary')">薪资与经验关系</a></dt>
				<dt><a href="javascript:void(0);" onclick="getData('region_salary')">薪资与岗位需求关系</a></dt>
			</dl>
		</li>
	</ul>
    </div>
    <div class="box2" id="box2" align="center"><!--图表展示-->
        <h3>职责词云</h3>
        <br/>
        <img src="/static/images/cloudwords/{{ pid }}.png" width="80%" height="80%">
    </div>
    <div class="box3"><!--个人中心部分-->
        <div class="self">
            <img src="/static/images/tou1.jpg" alt="" width="100%" height="100%" >
        </div>
        <div class="enter">
            <a href="{% url 'selfcenter' %}">个人中心</a><!--进入个人中心-->
        </div>
        <!--热门招聘信息-->
        <div class="show">
            <div class="show1">
                <h4>热门招聘信息</h4>
            </div>
            <div class="show2">
                <ul>
                    <li><a href="#">【TOP1】这里是热度第一的招聘信息</a></li>
                    <li><a href="#">【TOP2】这里是热度第二的招聘信息</a></li>
                    <li><a href="#">【TOP3】这里是热度第三的招聘信息</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>
<div class="return">
    <a href="{% url 'index' %}"></a>
</div>
<script type="text/javascript">
    function getData(analysis_item) {
            var dom=document.getElementById("box2");
            var myChart=echarts.init(dom);
            var option=null;
            var i;
            var newData=[];
            var temp=[];
            var post_data={
                "type":analysis_item,
                "pid":{{ pid }},
            };
            $.ajax({
                url: '/get_analysis/',
                type: "POST",
                data: post_data,
                success: function (data) {
                    res = JSON.parse(data);
                    if(res['marks']==0){
                        option = {
                            title: {
                                text: res['profession']+'岗位各公司规模总数分布条形图',
                                left: 'center',
                                top:10,
                                textStyle: {
                                    fontWeight: 'normal',              //标题颜色
                                    color: '#666666',
                                },
                            },
                            xAxis: [
                                {
                                    type: 'category',
                                    data: res.data_x,
                                    axisTick: {
                                        alignWithLabel: true
                                    },
                                    axisLabel: {
                                        interval:0
                                    }
                                }
                            ],
                            tooltip: {
                                trigger: 'axis'
                            },
                            toolbox: {
                                show: true,
                                feature: {
                                    dataView: {show: true, readOnly: false},
                                    magicType: {show: true, type: ['line', 'bar']},
                                    restore: {show: true},
                                    saveAsImage: {show: true}
                                }
                            },
                            yAxis: [
                                {
                                    type: 'value',
                                    name:  '企业数目 /家',
                                }
                            ],
                            series: [
                                {
                                    color:'#0099CC',
                                    name: '企业数目',
                                    type: 'bar',
                                    data: res.data_y,
                                }
                            ]
                        };
                        ;
                        if (option && typeof option === "object") {
                            myChart.setOption(option, true);
                        }
                    }else if(res['marks']==1){
                        for(i=0;i<res.data_x.length;i++){
                            newData.push({value:res.data_y[i],name:res.data_x[i]});
                        }
                        option = {
                            title: {
                                text: res['profession']+'岗位中各类型企业所占比例',
                                left: 'center',
                                padding: 15,
                                textStyle: {
                                    fontWeight: 'normal',              //标题颜色
                                    color: '#666666',
                                },
                            },
                            tooltip: {
                                trigger: 'item',
                                formatter: '{a} <br/>{b} : {c} ({d}%)'
                            },
                            legend: {
                                left: 'center',
                                top: 'bottom',
                                data: res.data_x,
                            },
                            series: [
                                {
                                    name:'企业类型',
                                    type: 'pie',
                                    radius: '55%',
                                    center: ['50%', '49%'],
                                    data: newData,
                                    emphasis: {
                                        itemStyle: {
                                            shadowBlur: 10,
                                            shadowOffsetX: 0,
                                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                                        }
                                    }
                                }
                            ]
                        };
                        ;
                        if (option && typeof option === "object") {
                            myChart.setOption(option, true);
                        }
                    }else if(res["marks"]==2){
                        res.data_x.forEach((data,index) => {
                            //判断属于哪个省份
                            provinces.forEach((item, index) => {
                                item.city.forEach((itt, idx) => {
                                    if (itt.name.search(data) != -1) {
                                        newData.push (item.name)
                                    }
                                })
                            })
                        })
                        for(i=0;i<newData.length;i++){
                            temp.push({value:res.data_y[i],name:newData[i]});
                        }
                        option = {
                            title: {
                                text: res['profession']+'各地区需求量',
                                left: "center",
                                textStyle: {
                                    fontWeight: 'normal',              //标题颜色
                                    color: '#666666',
                                },
                            },
                            tooltip : {
                                trigger: 'item'
                            },
                            legend: {
                                orient: 'vertical',
                                left: 'left',
                                data:['需求量']
                            },
                            visualMap: {
                                min: 0,
                                max: 2500,
                                left: 'left',
                                top: 'bottom',
                                text:['高','低'],           // 文本，默认为数值文本
                                calculable : true
                            },
                            series : [
                                {
                                    name:  '需求量',
                                    type: 'map',
                                    mapType: 'china',
                                    roam: false,
                                    label: {
                                        normal: {
                                            show: false
                                        },
                                        emphasis: {
                                            show: true
                                        }
                                    },
                                    data:temp,
                                },
                            ]
                        };
                        ;
                        if (option && typeof option === "object") {
                            myChart.setOption(option, true);
                        }
                    }else if(res["marks"]==3){
                        console.log(res.data_x)
                        option = {
                            title: {
                                text: res['profession']+'岗位需求量排名前20地区的薪资水平状况',
                                left: "center",
                                textStyle: {
                                    fontWeight: 'normal',
                                    color: '#666666',
                                },
                            },
                            tooltip: {
                                trigger: 'axis',
                                axisPointer: {
                                    type: 'cross',
                                    label: {
                                        backgroundColor: '#6a7985'
                                    }
                                }
                            },
                            legend: {
                                data: [ '最高工资','最低工资'],
                                top:'bottom',
                            },
                            toolbox: {
                                feature: {
                                    saveAsImage: {}
                                }
                            },
                            grid: {
                                left: '3%',
                                right: '4%',
                                bottom: '10%',
                                containLabel: true
                            },
                            xAxis: [
                                {
                                    type: 'category',
                                    boundaryGap: false,
                                    data: res.data_x,
                                }
                            ],
                            yAxis: [
                                {
                                    type: 'value',
                                    name: '薪资 /元',
                                }
                            ],
                            series: [
                                {
                                    name: '最低工资',
                                    type: 'line',
                                    stack: '总量',
                                    areaStyle: {},
                                    data: res.data_y,
                                },
                                {
                                    name: '最高工资',
                                    type: 'line',
                                    stack: '总量',
                                    label: {
                                        normal: {
                                            show: true,
                                            position: 'top'
                                        }
                                    },
                                    areaStyle: {},
                                    data:  res.data_z,
                                }
                            ]
                        };
                        ;
                        if (option && typeof option === "object") {
                            myChart.setOption(option, true);
                        }
                    }else if(res["marks"]==4){
                        for(i=0;i<res.data_x.length;i++){
                            newData.push({value:res.data_y[i],name:res.data_x[i]});
                        }
                        option = {
                            title: {
                                text: res['profession']+'岗位各学历要求比例',
                                left: "center",
                                top:10,
                                textStyle: {
                                    fontWeight: 'normal',              //标题颜色
                                    color: '#666666',
                                },
                            },
                            tooltip: {
                                trigger: 'item',
                                formatter: '{a} <br/>{b}: {c} ({d}%)'
                            },
                            legend: {
                                orient: 'vertical',
                                left:10,
                                top: 'bottom',
                                data: res.data_x,
                            },
                            series: [
                                {
                                    name: '学历分布',
                                    type: 'pie',
                                    radius: ['50%', '71%'],
                                    avoidLabelOverlap: false,
                                    label: {
                                        show: false,
                                        position: 'center'
                                    },
                                    emphasis: {
                                        label: {
                                            show: true,
                                            fontSize: '30',
                                            fontWeight: 'bold'
                                        }
                                    },
                                    labelLine: {
                                        show: false
                                    },
                                    data: newData,
                                }
                            ]
                        };
                        ;
                        if (option && typeof option === "object") {
                            myChart.setOption(option, true);
                        }
                    }else if(res["marks"]==5){
                        option = {
                            title: {
                                text: res['profession']+'岗位工作经验要求',
                                left: "center",
                                top:10,
                                textStyle: {
                                    fontWeight: 'normal',              //标题颜色
                                    color: '#666666',
                                },
                            },
                            tooltip: {
                                trigger: 'axis',
                                axisPointer: {
                                    type: 'shadow'
                                }
                            },
                            grid: {
                                left: '3%',
                                right: '4%',
                                bottom: '3%',
                                containLabel: true
                            },
                            xAxis: {
                            },
                            yAxis: {
                                type: 'category',
                                data: res.data_x,
                            },
                            series: [
                                {
                                    color:'#00CC99',
                                    type: 'bar',
                                    data: res.data_y,
                                }
                            ]
                        };
                        ;
                        if (option && typeof option === "object") {
                            myChart.setOption(option, true);
                        }

                    }else if(res["marks"]==6){
                        option = {
                            title: {
                                text: res['profession']+'岗位各学历对应的工资水平',
                                left: "center",
                                textStyle: {
                                    fontWeight: 'normal',              //标题颜色
                                    color: '#666666',
                                },
                            },
                            tooltip: {
                                trigger: 'axis',
                                axisPointer: {
                                    type: 'cross',
                                    label: {
                                        backgroundColor: '#6a7985'
                                    }
                                }
                            },
                            legend: {
                                data: ['平均工资', '最高工资','最低工资'],
                                top:'bottom',
                            },
                            toolbox: {
                                feature: {
                                    saveAsImage: {}
                                }
                            },
                            grid: {
                                left: '3%',
                                right: '4%',
                                bottom: '10%',
                                containLabel: true
                            },
                            xAxis: [
                                {
                                    type: 'category',
                                    boundaryGap: false,
                                    data: res.data_x,
                                }
                            ],
                            yAxis: [
                                {
                                    type: 'value',
                                    name: '薪资 /元',
                                },
                            ],
                            series: [
                                {
                                    name: '平均工资',
                                    type: 'line',
                                    stack: '总量',
                                    areaStyle: {},
                                    data:  res.data_y,
                                },
                                {
                                    name: '最低工资',
                                    type: 'line',
                                    stack: '总量',
                                    areaStyle: {},
                                    data:  res.data_a,
                                },
                                {
                                    name: '最高工资',
                                    type: 'line',
                                    stack: '总量',
                                    label: {
                                        normal: {
                                            show: true,
                                            position: 'top'
                                        }
                                    },
                                    areaStyle: {},
                                    data:   res.data_z,
                                }
                            ]
                        };
                        ;
                        if (option && typeof option === "object") {
                            myChart.setOption(option, true);
                        }

                    }else if(res["marks"]==7){
                        option = {
                            title: {
                                text: res['profession']+'各工作经验对应的薪资水平',
                                left: "center",
                                textStyle: {
                                    fontWeight: 'normal',              //标题颜色
                                    color: '#666666',
                                },
                            },
                            tooltip: {
                                trigger: 'axis',
                                axisPointer: {
                                    type: 'cross',
                                    label: {
                                        backgroundColor: '#6a7985'
                                    }
                                }
                            },
                            legend: {
                                data: ['平均工资', '最高工资','最低工资'],
                                top:'bottom',
                            },
                            toolbox: {
                                feature: {
                                    saveAsImage: {}
                                }
                            },
                            grid: {
                                left: '3%',
                                right: '4%',
                                bottom: '10%',
                                containLabel: true
                            },
                            xAxis: [
                                {
                                    type: 'category',
                                    boundaryGap: false,
                                    data:res.data_x,
                                }
                            ],
                            yAxis: [
                                {
                                    type: 'value',
                                    name: '薪资 /元',
                                },
                            ],
                            series: [
                                {
                                    name: '平均工资',
                                    type: 'line',
                                    stack: '总量',
                                    areaStyle: {},
                                    data: res.data_y,
                                },
                                {
                                    name: '最低工资',
                                    type: 'line',
                                    stack: '总量',
                                    areaStyle: {},
                                    data: res.data_a,
                                },
                                {
                                    name: '最高工资',
                                    type: 'line',
                                    stack: '总量',
                                    label: {
                                        normal: {
                                            show: true,
                                            position: 'top'
                                        }
                                    },
                                    areaStyle: {},
                                    data: res.data_z,
                                }
                            ]
                        };
                        ;
                        if (option && typeof option === "object") {
                            myChart.setOption(option, true);
                        }

                    }else{

                    }
                }
            });
        }
    {#var nav=document.querySelector('.nav')#}
    {#var lis=nav.children;#}
    {#for(var i=0;i<lis.length;i++) {#}
    {#    lis[i].onmouseover= function () {#}
    {#        this.children[1].style.display = 'block';#}
    {#    }#}
    {#    lis[i].onmouseout= function () {#}
    {#        this.children[1].style.display = 'none';#}
    {#    }#}
    $(".menu ul li").click(function(){
		$(this).find("dl").slideToggle(200).parent().siblings().find("dl").slideUp(200);
		$(this).find("span i").toggleClass('action').parents().siblings().find("span i").removeClass('action');
	})

</script>
</body>
</html>